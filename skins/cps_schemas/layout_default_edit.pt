<metal:block define-macro="disp"
  tal:define="layout options/layout;
              ds options/datastructure;
              dm options/datamodel;
              ok options/ok|python:1;">
<div class="message" tal:condition="not:ok">
  <span i18n:translate="cpsdoc_form_error">Form error.</span>
</div>
<div class="group">
<form action="." method="POST" enctype="multipart/form-data"
  tal:attributes="action string:cpsdocument_edit_form">
<table width="100%" cellpadding="2" cellspacing="2" border="0">
  <tr tal:repeat="row layout/rows" valign="top">
    <td tal:repeat="cell row"
      tal:attributes="colspan cell/ncols">
      <tal:block define="widget cell/widget;
                         wid widget/getWidgetId;
                         err python:ds.getError(wid);">
        <div tal:attributes="class python:test(err, 'row error', 'row')">
          <div class="label" tal:condition="widget/title">
            <span i18n:translate="" tal:condition="widget/is_i18n"
              tal:content="widget/title">label</span>
            <span tal:condition="not:widget/is_i18n"
              tal:content="widget/title">label</span>
          </div>
          <div class="field">
            <div tal:replace="structure python:widget.render('edit', ds, dm)"/>
          </div>
          <tal:block condition="err">
            <br><em style="color: red"
                  i18n:translate="" tal:content="err">err</em>
          </tal:block>
        </div>
      </tal:block>
    </td>
  </tr>
</table>
<input type="submit" class="standalone" name="cpsdocument_edit_button"
  value="button_change" i18n:attributes="value" />
</form>
</div>
</metal:block>
