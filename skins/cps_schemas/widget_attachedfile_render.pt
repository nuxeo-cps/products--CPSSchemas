<tal:block define="mode options/mode;
                   id here/getWidgetId;
                   current_name options/current_name;
                   empty_file options/empty_file;
                   mimetype options/mimetype;
                   size options/size;
                   content_url options/content_url;
                   last_modified options/last_modified;
                  ">
<tal:block condition="python: mode == 'view' and not empty_file">
  <div
    tal:define="preview_id python:options['datastructure'][id+'_preview']">
    <a target="_blank"  condition="mimetype"
      tal:attributes="href string:${content_url}?nocache=${last_modified}">
      <tal:block
        replace="structure python:here.getImgTag(mimetype.icon_path, zoom=2,
        title=mimetype.name())" /></a>
    <a class="strong"
      tal:attributes="href string:${content_url}?nocache=${last_modified}">
      <tal:block replace="current_name" /></a>

    <span tal:condition="size" class="note"
          tal:define="b python:size < 1024;
                      m python:size > 1048576;
                      k python:not b and not m;">
            -
      <tal:block condition="b" content="string:1 K"/>
      <tal:block condition="m" content="python:'%.02f M' % float(size / 1048576.0)"/>
      <tal:block condition="k" content="python:'%s K' % (size / 1024)"/>
    </span>
    <span tal:condition="preview_id">
      <a href="http://url..." target="_blank"
         tal:attributes="href preview_id"
         i18n:translate="cpsschema_link_preview">
       (preview)
      </a>
    </span>
  </div>

</tal:block>

<tal:block condition="python: mode == 'edit'">
  <metal:block use-macro="here/widget_image_render/macros/file_edit" />
</tal:block>

</tal:block>
