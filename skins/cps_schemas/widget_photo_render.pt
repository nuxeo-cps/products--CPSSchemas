<tal:block define="mode options/mode;
  id here/getWidgetId;
  value_name here/getHtmlWidgetId;
  fields here/fields;
  current_name options/current_name;
  current_title options/current_title;
  empty_file options/empty_file;
  mimetype options/mimetype;
  size options/size;
  content_url options/content_url;
  image_tag options/image_tag;
  image_width options/width;
  subtitle options/subtitle;
  rposition options/render_position;
  configurable options/configurable;
  last_modified options/last_modified;
  ">
  <tal:block condition="python: mode == 'view' and not empty_file">
    <div tal:attributes="class python:test(rposition == 'right', 'dright',
                                      test(rposition == 'center', 'dcenter', 'dleft'))">
      <img tal:replace="structure image_tag" />
      <div tal:condition="subtitle"
           style="width: 100px;"
           tal:attributes="style python:'width: %spx;;' % image_width">
        <small tal:content="subtitle" />
      </div>
    </div>
  </tal:block>

  <tal:block condition="python: mode == 'edit'">
    <metal:block use-macro="here/widget_image_render/macros/image_title_edit" />

    <img tal:condition="python: not empty_file"
      tal:replace="structure image_tag" />

    <tal:block define="allow_resize here/allow_resize|nothing;
                       keep_original here/keep_original|nothing;
                       can_keep_original python:allow_resize and keep_original and len(fields)>3 or 0">
    <metal:block use-macro="here/widget_image_render/macros/image_edit">
      <metal:block fill-slot="edit_file_action"
        tal:condition="python:not empty_file and can_keep_original">
        <li>
          <input type="radio" class="noborder" name="." value="resize"
                 tal:attributes="name radio_name;
                                 id string:${radio_name}_resize" />
          <label i18n:translate="cpsschemas_label_image_resize"
                 tal:attributes="for string:${radio_name}_resize">resize</label>
          <select tal:attributes="name string:${name}_resize_kept;
            onchange string:document.getElementById('${radio_name}_resize').checked='checked';"
            tal:define="wid_size python:(here.display_width, here.display_height);
            sizes python:[s for s in here.getImgSizes() if not wid_size[0] or s['size'] < wid_size]">
            <option tal:repeat="op sizes"
                    tal:attributes="value op/id"
                    tal:content="op/id" i18n:translate="" />
          </select>
        </li>
      </metal:block>
    </metal:block>
    </tal:block>

    <tal:block condition="python:len(fields) > 2 and configurable.find('position')>=0">
      <p tal:define="name here/getHtmlWidgetId;
                     title_name string:${name}_title;">
        <span i18n:translate="cpsschemas_render_position">
          Render position
        </span>
        <select tal:attributes="name string:${value_name}_rposition">
          <option tal:repeat="op here/all_render_positions"
            tal:attributes="selected python:op == rposition;
                            value op"
            tal:content="string:cpsschemas_rposition_${op}"
            i18n:translate="" />
        </select>
      </p>
    </tal:block>

    <tal:block condition="python:len(fields)>1">
      <span i18n:translate="cpsschemas_photo_subtitle">
        Photo subtitle
      </span>
      <input type="text" size="30"
             tal:attributes="name string:${value_name}_subtitle;
                             value subtitle" />
    </tal:block>

  </tal:block>

</tal:block>
